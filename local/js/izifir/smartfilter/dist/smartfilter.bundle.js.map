{"version":3,"file":"smartfilter.bundle.js","sources":["../src/smartfilter.js"],"sourcesContent":["import './style/style.scss'\r\nimport 'main.core'\r\n\r\nexport class Smartfilter\r\n{\r\n\tconstructor (selector)\r\n\t{\r\n\t\tthis.root = document.querySelector(selector);\r\n\t\tthis.sortItems = document.querySelectorAll('.smart-filter__sort');\r\n\r\n\t\tthis.container = document.querySelector('[data-container]')\r\n\t\tthis.target = this.container.querySelector('[data-target]')\r\n\t\tthis.pagination = this.container.querySelector('[data-pagination]')\r\n\t\tthis.filter = document.querySelector('[data-filter]');\r\n\r\n\t\tif (this.root) {\r\n\t\t\tthis.initFilter()\r\n\t\t}\r\n\r\n\t\tif (this.sortItems.length !== 0) {\r\n\t\t\tthis.initSort()\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tinitSort()\r\n\t{\r\n\t\tthis.sorts = document.querySelectorAll('.smart-filter__sort')\r\n\r\n\t\tif (this.sorts.length) {\r\n\t\t\t[].forEach.call(this.sorts, (sort) => {\r\n\t\t\t\tsort.addEventListener('change', this.changeSortItem.bind(this))\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tthis.clearSortItem();\r\n\t}\r\n\r\n\tchangeSortItem(evt = new Event('change'))\r\n\t{\r\n\t\tconst item = evt.target || evt.currentTarget\r\n\t\tconst self = this;\r\n\r\n\t\tlet params = new URLSearchParams(window.location.search);\r\n\t\tlet sort_by = params.get('sort_by');\r\n\t\tlet sort_order = params.get('sort_order');\r\n\t\tlet order = \"desc\";\r\n\r\n\t\tthis.clearSortItem();\r\n\r\n\t\tif (!sort_by) {\r\n\t\t\titem.checked = true;\r\n\t\t}\r\n\r\n\t\tif (sort_order === \"desc\") {\r\n\t\t\torder = \"asc\";\r\n\t\t}\r\n\r\n\t\tlet getData = \"?sort_by=\" + item.name + \"&sort_order=\" + order\r\n\r\n\t\tBX.ajax({\r\n\t\t\turl: getData,\r\n\t\t\tmethod: 'GET',\r\n\t\t\tdataType: 'html',\r\n\t\t\tscriptsRunFirst: false,\r\n\t\t\temulateOnload: false,\r\n\t\t\tcache: false,\r\n\t\t\tprocessData: false,\r\n\t\t\tonsuccess (data)\r\n\t\t\t{\r\n\t\t\t\tlet fragment = document.createElement('span')\r\n\t\t\t\tfragment.insertAdjacentHTML('afterbegin', data)\r\n\t\t\t\tlet newTarget = fragment.querySelector('#blog-card')\r\n\t\t\t\tlet old = document.querySelector('#blog-card');\r\n\r\n\t\t\t\tif (newTarget) {\r\n\t\t\t\t\told.innerHTML = newTarget.innerHTML;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst container = fragment.querySelector('[data-container=\"blog-list\"]')\r\n\t\t\t\tconst pagination = container.querySelector('[data-pagination]');\r\n\r\n\t\t\t\tif (pagination && self.pagination) {\r\n\t\t\t\t\tself.pagination.innerHTML = pagination.innerHTML;\r\n\t\t\t\t} else if (pagination && !self.pagination && self.target) {\r\n\t\t\t\t\tself.target.after(pagination);\r\n\t\t\t\t} else if (!pagination && this.pagination) {\r\n\t\t\t\t\tself.pagination.remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (window.AjaxPagination && window.AjaxPagination.length) {\r\n\t\t\t\t\twindow.AjaxPagination.forEach((pager) => {\r\n\t\t\t\t\t\tif (pager.target && pager.target.id === 'blog-card') {\r\n\t\t\t\t\t\t\tpager.init();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\r\n\t\t\t\thistory.pushState({}, '', getData);\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tthis.clearSortItem(item.name, order);\r\n\r\n\t}\r\n\r\n\tclearSortItem(getName = null, order = null)\r\n\t{\r\n\t\tlet params = new URLSearchParams(window.location.search);\r\n\t\tlet sort_by = params.get('sort_by');\r\n\t\tlet sort_order = params.get('sort_order');\r\n\t\tlet sortButton = document.querySelectorAll('.smart-filter__sort');\r\n\r\n\t\tif (order) {\r\n\t\t\tsort_order = order;\r\n\t\t}\r\n\r\n\t\tif (getName) {\r\n\t\t\tsort_by = getName;\r\n\t\t}\r\n\r\n\t\tif (!sort_by) {\r\n\t\t\tsort_by = sortButton[0].name;\r\n\t\t\tsortButton[0].closest(\".smart-filter__item\").querySelector('.smart-filter__label_sort').classList.add('sort-up');\r\n\t\t}\r\n\r\n\t\tsortButton.forEach(element => {\r\n\t\t\tlet span = element.closest(\".smart-filter__item\").querySelector('.smart-filter__label_sort');\r\n\t\t\tif (element.name === sort_by) {\r\n\t\t\t\telement.checked = true;\r\n\t\t\t\tif (sort_order === \"asc\") {\r\n\t\t\t\t\tspan.classList.add('sort-up');\r\n\t\t\t\t\tspan.classList.remove('sort-down');\r\n\t\t\t\t}\r\n\t\t\t\tif (sort_order === \"desc\") {\r\n\t\t\t\t\tspan.classList.add('sort-down');\r\n\t\t\t\t\tspan.classList.remove('sort-up');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\telement.checked = false;\r\n\t\t\t\tspan.classList.remove('sort-up');\r\n\t\t\t\tspan.classList.remove('sort-down');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tinitFilter()\r\n\t{\r\n\t\tthis.items = this.root.querySelectorAll('[data-filter-item]')\r\n\t\tthis.clears = this.root.querySelectorAll('[data-filter-clear]')\r\n\r\n\t\tif (this.items.length) {\r\n\t\t\t[].forEach.call(this.items, (item) => {\r\n\t\t\t\titem.addEventListener('change', this.changeFilterItem.bind(this))\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tif (this.clears.length) {\r\n\t\t\t[].forEach.call(this.clears, (clear) => {\r\n\t\t\t\tclear.addEventListener('change', this.clearClickHandler.bind(this))\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tclearClickHandler (evt)\r\n\t{\r\n\t\tconst btn = evt.target || evt.currentTarget\r\n\t\tconst id = btn.dataset.filterClear\r\n\t\tif (btn.type === 'checkbox')\r\n\t\t\tbtn.checked = true\r\n\r\n\t\tconst items = [];\r\n\t\t[].forEach.call(this.items, (item) => {\r\n\t\t\tif (item.dataset.filterItem === id) {\r\n\t\t\t\titems.push(item)\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t[].forEach.call(items, (item) => {\r\n\t\t\titem.checked = false\r\n\t\t})\r\n\r\n\t\tthis.changeFilterItem()\r\n\t}\r\n\r\n\tchangeFilterItem (evt = new Event('change'))\r\n\t{\r\n\t\tthis.dispatchStartEvent()\r\n\t\tconst item = evt.target || evt.currentTarget\r\n\t\tconst formData = new BX.ajax.FormData()\r\n\t\tformData.append('ajax', 'y');\r\n\t\t[].forEach.call(this.items, (item, key) => {\r\n\t\t\tswitch (item.type) {\r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\tif (item.checked) {\r\n\t\t\t\t\t\tformData.append(item.name, item.value)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (item.value.length > 0) {\r\n\t\t\t\t\t\tformData.append(item.name, item.value)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tif (item) {\r\n\t\t\tconst id = item.dataset.filterItem\r\n\t\t\tconst clear = this.root.querySelector('[data-filter-clear=\"' + id + '\"]')\r\n\t\t\tclear.checked = false\r\n\t\t}\r\n\r\n\t\tformData.send(window.location.href, response => {\r\n\t\t\tthis.dispatchEndEvent(JSON.parse(response))\r\n\t\t})\r\n\t}\r\n\r\n\tdispatchStartEvent ()\r\n\t{\r\n\t\tconst event = new CustomEvent('before.smart.filter')\r\n\t\tdocument.dispatchEvent(event)\r\n\t}\r\n\r\n\tdispatchEndEvent (result)\r\n\t{\r\n\t\tconst event = new CustomEvent('after.smart.filter', {detail: result})\r\n\t\tdocument.dispatchEvent(event)\r\n\t}\r\n\r\n}"],"names":["Smartfilter","selector","this","root","document","querySelector","sortItems","querySelectorAll","container","target","pagination","filter","initFilter","length","initSort","_proto","sorts","forEach","call","sort","addEventListener","_this","changeSortItem","bind","clearSortItem","evt","Event","item","currentTarget","self","params","URLSearchParams","window","location","search","sort_by","get","sort_order","order","checked","getData","name","BX","ajax","url","method","dataType","scriptsRunFirst","emulateOnload","cache","processData","onsuccess","data","fragment","createElement","insertAdjacentHTML","newTarget","old","innerHTML","after","remove","AjaxPagination","pager","id","init","history","pushState","getName","sortButton","closest","classList","add","element","span","items","clears","_this2","changeFilterItem","clear","clearClickHandler","btn","dataset","filterClear","type","filterItem","push","dispatchStartEvent","formData","FormData","append","key","value","send","href","response","_this3","dispatchEndEvent","JSON","parse","event","CustomEvent","dispatchEvent","result","detail"],"mappings":"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"}